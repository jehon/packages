#
# File: /home/jehon/.bashrc
#

# See https://unix.stackexchange.com/a/26782/240487
# interactive => if [[ $- == *i* ]]
# login       => if shopt -q login_shell

## SCREEN: autostart if .jhn-auto-screen ##

if [[ -r ".jhn-auto-screen" ]]; then
    if [[ -z "${STY}" ]]; then
        # We are not in screen
        if [[ $- == *i* ]] && [[ ! -z "${SSH_CLIENT}" ]]; then
            # But since we are on ssh, and interactive, we should be
            screen -RR -l
            exit $?
        fi
    fi
fi

## PROMPT ##

__parse_git_branch() {
    if ! git branch >/dev/null 2>&1; then
        return
    fi
    echo -n "("
    echo -n "$(basename "$(git rev-parse --show-toplevel)" )"
    echo -n ":"
    echo -n "$(git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1/')"
    if [[ ! -z $(git status -s) ]]; then
        echo -n "*"
    fi
    echo -n ")"
}

__cmd_result() {
    __LAST_RESULT="$?"
    case "$__LAST_RESULT" in
        0)
            echo -ne "\033[01;32m✓\033[00m"
            ;;
        130)
            # Ctrl-C
            echo -ne "\033[31m^C\033[00m"
            ;;
        *)
            echo -ne "\033[31m✗\033[00m"
            ;;
    esac

    PS1+="${RCol}@${BBlu}\h ${Pur}\W${BYel}$ ${RCol}"
}

# Start with a white line
PS1=''
# last command result / git status / screen id
PS1=$PS1'\n$(__cmd_result) \033[33m$(__parse_git_branch)\[\033[00m\] ${STY:+(screen) }'

# user@host / folder
PS1=$PS1'\n${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;37m\]\w\[\033[00m\] \$ '

CDPATH=".:~/Documents/src"

HOST_UID="$(id -u)"
HOST_GID="$(id -g)"
